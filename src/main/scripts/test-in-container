#!/bin/sh -ex
k-configure-opam-dev || true
opam depext conf-pkg-config.1.1 || true
eval $(opam config env)
opam depext conf-pkg-config.1.1 || true
false
cp -R /usr/share/kframework/tutorial ~
WD=`pwd`
cd
echo 'Starting kserver...'
spawn-kserver $WD/kserver.log
cd tutorial
echo 'Testing tutorial in user environment...'
make -j`nproc`
cd ~
echo "module TEST imports BOOL endmodule" > test.k
kompile test.k --backend ocaml
kompile test.k --backend haskell
